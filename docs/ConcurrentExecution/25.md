---
prev:
  text: '24. çº¿ç¨‹ä¸è¿›ç¨‹ç®€ä»‹'
  link: '/ConcurrentExecution/24'
next:
  text: '26. QRunnable ç¤ºä¾‹'
  link: '/ConcurrentExecution/26'
---

## 25. ä½¿ç”¨çº¿ç¨‹æ± 

Qt æä¾›äº†ä¸€ä¸ªéå¸¸ç®€å•çš„æ¥å£ï¼Œç”¨äºåœ¨å…¶ä»–çº¿ç¨‹ä¸­è¿è¡Œä»»åŠ¡ï¼Œè¯¥æ¥å£åœ¨ PyQt6 ä¸­å¾—åˆ°äº†å¾ˆå¥½çš„å®ç°ã€‚è¯¥æ¥å£å›´ç»•ä¸¤ä¸ªç±»æ„å»ºâ€”â€”`QRunnable` å’Œ `QThreadPool`ã€‚å‰è€…æ˜¯ç”¨äºå­˜æ”¾æ‚¨è¦æ‰§è¡Œçš„ä»»åŠ¡çš„å®¹å™¨ï¼Œè€Œåè€…åˆ™æ˜¯ç®¡ç†æ‚¨çš„å·¥ä½œçº¿ç¨‹çš„çº¿ç¨‹æ± ã€‚

ä½¿ç”¨ `QThreadPool` çš„å¥½å¤„åœ¨äºï¼Œå®ƒå¯ä»¥ä¸ºæ‚¨å¤„ç†ä»»åŠ¡çš„æ’é˜Ÿå’Œæ‰§è¡Œæ»‘å—ã€‚é™¤äº†æ’é˜Ÿä½œä¸šå’Œæ£€ç´¢ç»“æœå¤–ï¼Œå‡ ä¹æ— éœ€åšå…¶ä»–äº‹æƒ…ã€‚

## ä½¿ç”¨ `QRunnable`

è¦å®šä¹‰è‡ªå®šä¹‰ `QRunnable`ï¼Œæ‚¨å¯ä»¥ç»§æ‰¿åŸºç¡€ `QRunnable` ç±»ï¼Œç„¶åå°†å¸Œæœ›æ‰§è¡Œçš„ä»£ç æ”¾ç½®åœ¨ `run()` æ–¹æ³•ä¸­ã€‚ä»¥ä¸‹æ˜¯å°†æˆ‘ä»¬çš„é•¿æ—¶é—´ `sleep` ä»»åŠ¡å®ç°ä¸º `QRunnable` çš„ç¤ºä¾‹ã€‚å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ° `MainWindow` ç±»å®šä¹‰ä¹‹å‰ã€‚

*Listing 173. concurrent/qrunnable_1.py*

```python
class Worker(QRunnable):
    """
    å·¥ä½œçº¿ç¨‹
    """
    @pyqtSlot()
    def run(self):
        """
        æ‚¨çš„ä»£ç åº”æ”¾ç½®åœ¨æ­¤æ–¹æ³•ä¸­
        """
        print("Thread start")
        time.sleep(5)
        print("Thread complete")
```

åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œæˆ‘ä»¬çš„å‡½æ•°ï¼Œåªéœ€åˆ›å»ºä¸€ä¸ª `Worker` çš„å®ä¾‹ï¼Œç„¶åå°†å…¶ä¼ é€’ç»™æˆ‘ä»¬çš„`QThreadPool` å®ä¾‹å³å¯ã€‚

æˆ‘ä»¬åœ¨ `__init__` å—ä¸­åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± çš„å®ä¾‹ã€‚

*Listing 174. concurrent/qrunnable_1.py*

```python
class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.threadpool = QThreadPool()
        print(
            "Multithreading with maximum %d threads"
            % self.threadpool.maxThreadCount()
        )
```

æœ€åï¼Œç”¨ä»¥ä¸‹ä»£ç æ›¿æ¢ `oh_no` æ–¹æ³•ï¼Œä»¥åˆ›å»ºå¹¶æäº¤

*Listing 175. concurrent/qrunnable_1.py*

```python
    def oh_no(self):
        worker = Worker()
        self.threadpool.start(worker)
```

ç°åœ¨ï¼Œç‚¹å‡»æŒ‰é’®å°†åˆ›å»ºä¸€ä¸ªå·¥ä½œè¿›ç¨‹æ¥å¤„ç†ï¼ˆé•¿æœŸè¿è¡Œçš„ï¼‰è¿›ç¨‹ï¼Œå¹¶é€šè¿‡ `QThreadPool` æ± å°†å…¶åˆ†æ‹†åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ä¸­ã€‚å¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„çº¿ç¨‹æ¥å¤„ç†ä¼ å…¥çš„å·¥ä½œè¿›ç¨‹ï¼Œå®ƒä»¬å°†è¢«æ’å…¥é˜Ÿåˆ—ï¼Œå¹¶åœ¨ç¨åæŒ‰é¡ºåºæ‰§è¡Œã€‚

> ğŸš€ **è¿è¡Œå®ƒå§ï¼** æ‚¨ä¼šå‘ç°ï¼Œç°åœ¨åº”ç”¨ç¨‹åºå¯ä»¥å¤„ç†æ‚¨ç–¯ç‹‚ç‚¹å‡»æŒ‰é’®çš„æ“ä½œï¼Œè€Œä¸ä¼šå‡ºç°ä»»ä½•é—®é¢˜ã€‚

![Figure200](Figure200.png)

> å›¾200ï¼šç®€å•çš„ `QRunnable` ç¤ºä¾‹åº”ç”¨ç¨‹åºã€‚åªè¦å›¾å½¢ç”¨æˆ·ç•Œé¢çº¿ç¨‹æ­£åœ¨è¿è¡Œè®¡æ•°å™¨å°±ä¼šæ¯ç§’å¢åŠ  1

è¯·æ‚¨æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼Œä»¥è§‚å¯Ÿå·¥ä½œè¿›ç¨‹çš„å¯åŠ¨å’Œå®Œæˆæƒ…å†µã€‚

```bash
Multithreading with maximum 12 threads
Thread start
Thread start
Thread start
Thread complete
Thread complete
Thread complete
```

æ£€æŸ¥å¤šæ¬¡ç‚¹å‡»æŒ‰é’®æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚æ‚¨åº”è¯¥çœ‹åˆ°æ‚¨çš„çº¿ç¨‹ç«‹å³æ‰§è¡Œï¼Œç›´åˆ°è¾¾åˆ° `.maxThreadCount` æŠ¥å‘Šçš„æ•°é‡ã€‚å¦‚æœåœ¨å·²ç»å­˜åœ¨æ­¤æ•°é‡çš„æ´»è·ƒå·¥ä½œè€…åå†æ¬¡ç‚¹å‡»æŒ‰é’®ï¼Œåç»­çš„å·¥ä½œè€…å°†è¢«æ’é˜Ÿï¼Œç›´åˆ°æœ‰çº¿ç¨‹å¯ç”¨ã€‚

åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬è®© `QThreadPool` å†³å®šç†æƒ³çš„æ´»è·ƒçº¿ç¨‹æ•°ã€‚è¿™ä¸ªæ•°å€¼åœ¨ä¸åŒè®¡ç®—æœºä¸Šä¼šæœ‰æ‰€ä¸åŒï¼Œç›®çš„æ˜¯å®ç°æœ€ä½³æ€§èƒ½ã€‚ç„¶è€Œï¼Œæœ‰æ—¶æ‚¨å¯èƒ½éœ€è¦æŒ‡å®šç‰¹å®šçš„çº¿ç¨‹æ•°â€”â€”åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `.setMaxThreadCount` æ–¹æ³•æ˜¾å¼è®¾ç½®æ­¤å€¼ã€‚æ­¤å€¼æ˜¯é’ˆå¯¹æ¯ä¸ªçº¿ç¨‹æ± çš„ã€‚

## ä½¿ç”¨ `QThreadPool.start()`

åœ¨ä¹‹å‰çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬è‡ªå·±åˆ›å»ºäº†ä¸€ä¸ª `QRunnable` å¯¹è±¡ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™ `QThreadPool` ä»¥è¿›è¡Œæ‰§è¡Œã€‚ç„¶è€Œï¼Œå¯¹äºç®€å•çš„ç”¨ä¾‹ï¼ŒQté€šè¿‡ `QThreadPool.start()` æä¾›äº†ä¸€ä¸ªä¾¿æ·çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯ä»¥å¤„ç†æ‰§è¡Œä»»æ„çš„ Python å‡½æ•°å’Œæ–¹æ³•ã€‚Qt ä¼šä¸ºæ‚¨åˆ›å»ºå¿…è¦çš„ `QRunnable` å¯¹è±¡ï¼Œå¹¶å°†å®ƒä»¬æ’å…¥é˜Ÿåˆ—ã€‚

åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†å·¥ä½œæ”¾åœ¨äº† `do_some_work` æ–¹æ³•ä¸­ï¼Œå¹¶ä¿®æ”¹äº† `oh_no` æ–¹æ³•ï¼Œå°†å…¶ä¼ é€’ç»™çº¿ç¨‹æ± çš„ `.start()` æ–¹æ³•ã€‚

*Listing 176. concurrent/qthreadpool_start_1.py*

```python
    def oh_no(self):
        self.threadpool.start(self.do_some_work)

    @pyqtSlot()
    def do_some_work(self):
        print("Thread start")
        time.sleep(5)
        print("Thread complete")
        
    def recurring_timer(self):
        self.counter += 1
        self.l.setText("Counter: %d" % self.counter)
```

æŒ‰ä¸‹æŒ‰é’®å°†æ‰§è¡Œæˆ‘ä»¬åœ¨ `QThreadPool` ä¸Šå®šä¹‰çš„ `do_some_work` æ–¹æ³•ã€‚

![information](information.png)

> æ‚¨å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼å¯åŠ¨å¤šä¸ªçº¿ç¨‹ã€‚å°è¯•æŒ‰ä¸‹æŒ‰é’®ï¼Œç›´åˆ°è¾¾åˆ°æœ€å¤§å¹¶å‘çº¿ç¨‹æ•°ã€‚åœ¨çº¿ç¨‹æ± ä¸­æœ‰ç©ºé—²ç©ºé—´ä¹‹å‰ï¼Œä¸ä¼šå¯åŠ¨æ–°çš„çº¿ç¨‹ã€‚

å¯¹äºè®¸å¤šç®€å•çš„ä»»åŠ¡æ¥è¯´ï¼Œè¿™ç§æ–¹æ³•éå¸¸æœ‰æ•ˆã€‚åœ¨æ‰§è¡Œçš„å‡½æ•°ä¸­ï¼Œæ‚¨å¯ä»¥è®¿é—®ä¿¡å·ï¼Œå¹¶ä½¿ç”¨å®ƒä»¬æ¥å‘å‡ºæ•°æ®ã€‚æ‚¨æ— æ³•æ¥æ”¶ä¿¡å·â€”â€”æ²¡æœ‰åœ°æ–¹è¿æ¥å®ƒä»¬â€”â€”ä½†æ‚¨å¯ä»¥é€šè¿‡ `self` å¯¹è±¡ä¸å˜é‡è¿›è¡Œäº¤äº’ã€‚

æ›´æ–°ä»£ç ä»¥æ·»åŠ ä»¥ä¸‹ `custom_signal`ï¼Œå¹¶ä¿®æ”¹ `work` æ–¹æ³•ä»¥å‘å‡ºæ­¤ä¿¡å·å¹¶æ›´æ–° `self.counter` å˜é‡ã€‚

*Listing 177. concurrent/qthreadpool_start_2.py*

```python
class MainWindow(QMainWindow):
    
    custom_signal = pyqtSignal()
    
    def __init__(self):
        super().__init__()
        
        # å°†æˆ‘ä»¬çš„è‡ªå®šä¹‰ä¿¡å·è¿æ¥åˆ°å¤„ç†ç¨‹åº.
        self.custom_signal.connect(self.signal_handler)
        # etc.
    def oh_no(self):
        self.threadpool.start(self.do_some_work)
        
    @pyqtSlot()
    def do_some_work(self):
        print("Thread start")
        # å‘å‡ºæˆ‘ä»¬çš„å®šåˆ¶ä¿¡å·.
        self.custom_signal.emit()
        for n in range(5):
            time.sleep(1)
        self.counter = self.counter - 10
        print("Thread complete")
        
    def signal_handler(self):
        print("Signal received!")

    def recurring_timer(self):
        self.counter += 1
        self.l.setText("Counter: %d" % self.counter)
```

è¿è¡Œæ­¤ç¤ºä¾‹åï¼Œæ‚¨ä¼šå‘ç°ï¼Œè™½ç„¶å·¥ä½œæ–¹æ³•åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­è¿è¡Œï¼ˆç¡çœ ä¸ä¼šä¸­æ–­è®¡æ•°å™¨ï¼‰ï¼Œä½†æˆ‘ä»¬ä»ç„¶èƒ½å¤Ÿå‘å‡ºä¿¡å·å¹¶ä¿®æ”¹ `self.counter` å˜é‡ã€‚

![alert](alert.png)

> æ‚¨æ— æ³•ä»å¦ä¸€ä¸ªçº¿ç¨‹ç›´æ¥ä¿®æ”¹å›¾å½¢ç”¨æˆ·ç•Œé¢â€”â€”å°è¯•è¿™æ ·åšä¼šå¯¼è‡´åº”ç”¨ç¨‹åºå´©æºƒã€‚

![tips](tips.png)

> æ‚¨å¯ä»¥ä½¿ç”¨ä¿¡å·ä¿®æ”¹å›¾å½¢ç”¨æˆ·ç•Œé¢ã€‚ä¾‹å¦‚ï¼Œå°è¯•å°† `str` ä¿¡å·è¿æ¥åˆ°æ ‡ç­¾çš„ `.setText` æ–¹æ³•ã€‚

è™½ç„¶è¿™æ˜¯ä¸€ä¸ªæ–¹ä¾¿çš„å°ç•Œé¢ï¼Œä½†æ‚¨ç»å¸¸ä¼šå‘ç°è‡ªå·±å¸Œæœ›å¯¹æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æœ‰æ›´å¤šçš„æ§åˆ¶æƒï¼Œæˆ–è€…ä¸å®ƒä»¬è¿›è¡Œæ›´ç»“æ„åŒ–çš„é€šä¿¡ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†é€šè¿‡ä¸€äº›æ›´å¤æ‚çš„ç¤ºä¾‹ï¼Œä½¿ç”¨ `QRunnable` æ¥å±•ç¤ºä»€ä¹ˆæ˜¯å¯èƒ½çš„ã€‚

## æ‰©å±• QRunnable

å¦‚æœæ‚¨æƒ³å°†è‡ªå®šä¹‰æ•°æ®ä¼ é€’ç»™æ‰§è¡Œå‡½æ•°ï¼Œæ‚¨å¯ä»¥é…ç½®æ‚¨çš„è¿è¡Œå™¨ä»¥æ¥å—å‚æ•°æˆ–å…³é”®å­—ï¼Œç„¶åå°†è¿™äº›æ•°æ®å­˜å‚¨åœ¨ `QRunnable`çš„ `self` å¯¹è±¡ä¸­ã€‚è¿™äº›æ•°æ®éšåå¯ä»¥åœ¨ `run` æ–¹æ³•å†…éƒ¨è®¿é—®ã€‚

*Listing 178. concurrent/qrunnable_2.py*

```python
class Worker(QRunnable):
    """
    å·¥ä½œçº¿ç¨‹
    :param args: ä¼ é€’ç»™è¿è¡Œä»£ç çš„å‚æ•°
    :param kwargs: ä¼ é€’ç»™è¿è¡Œçš„å…³é”®å­—å‚æ•°
    :code
    :
    """
    def __init__(self, *args, **kwargs):
        super().__init__()
        self.args = args
        self.kwargs = kwargs
            
    @pyqtSlot()
    def run(self):
    """
    ä½¿ç”¨ä¼ é€’çš„ self.args åˆå§‹åŒ– runner å‡½æ•°ï¼Œ
    """
        print(self.args, self.kwargs)
    
    def oh_no(self):
        worker = Worker("some", "arguments", keywords=2)
        self.threadpool.start(worker)
```

![tips](tips.png)

> ç”±äºå‡½æ•°åœ¨ Python ä¸­ä¹Ÿæ˜¯å¯¹è±¡ï¼Œæ‚¨è¿˜å¯ä»¥å°†ä¸€ä¸ªå‡½æ•°ä¼ é€’ç»™è¿è¡Œå™¨ä»¥æ‰§è¡Œã€‚è¯·å‚é˜…åæ–‡çš„é€šç”¨ç¤ºä¾‹æ¥è·å–ä¸€ä¸ªç¤ºä¾‹ã€‚

## çº¿ç¨‹ I/O

æœ‰æ—¶ï¼Œèƒ½å¤Ÿä»è¿è¡Œä¸­çš„å·¥ä½œè€…è¿›ç¨‹ä¸­ä¼ é€’çŠ¶æ€å’Œæ•°æ®ä¼šéå¸¸æœ‰ç”¨ã€‚è¿™å¯èƒ½åŒ…æ‹¬è®¡ç®—ç»“æœã€æŠ›å‡ºçš„å¼‚å¸¸æˆ–æ­£åœ¨è¿›è¡Œçš„è¿›åº¦ï¼ˆä¾‹å¦‚è¿›åº¦æ¡ï¼‰ã€‚Qt æä¾›äº†ä¿¡å·å’Œæ§½æ¡†æ¶ï¼Œå…è®¸æ‚¨æ‰§è¡Œæ­¤æ“ä½œï¼Œå¹¶ä¸”æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå…è®¸ä»æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ç›´æ¥ä¸å›¾å½¢ç”¨æˆ·ç•Œé¢è¿›è¡Œå®‰å…¨é€šä¿¡ã€‚ä¿¡å·å…è®¸æ‚¨å‘å‡ºå€¼ï¼Œç„¶åè¿™äº›å€¼ç”±ä¸ `.connect` é“¾æ¥çš„æ§½å‡½æ•°åœ¨ä»£ç çš„å…¶ä»–ä½ç½®æ‹¾å–ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ `WorkerSignals` ç±»ï¼Œå®ƒåŒ…å«ä¸€äº›ç¤ºä¾‹ä¿¡å·ã€‚ä¿¡å·ã€‚

![information](information.png)

> è‡ªå®šä¹‰ä¿¡å·åªèƒ½åœ¨ä» `QObject` æ´¾ç”Ÿçš„å¯¹è±¡ä¸Šå®šä¹‰ã€‚ç”±äº `QRunnable` å¹¶éä» `QObject` æ´¾ç”Ÿï¼Œå› æ­¤æˆ‘ä»¬æ— æ³•ç›´æ¥åœ¨å…¶ä¸­å®šä¹‰ä¿¡å·ã€‚ä½¿ç”¨ä¸€ä¸ªç”¨äºä¿å­˜ä¿¡å·çš„è‡ªå®šä¹‰ `QObject` æ˜¯æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆã€‚

*Listing 179. concurrent/qrunnable_3.py*

```python
class WorkerSignals(QObject):
    """
    å®šä¹‰è¿è¡Œä¸­çš„å·¥ä½œçº¿ç¨‹å¯ç”¨çš„ä¿¡å·ã€‚
    æ”¯æŒçš„ä¿¡å·åŒ…æ‹¬ï¼š
    finished
        æ— æ•°æ®
    error
        `str` å¼‚å¸¸å­—ç¬¦ä¸²
    result
        `dict` å¤„ç†è¿”å›çš„æ•°æ®
    """
    finished = pyqtSignal()
    error = pyqtSignal(str)
    result = pyqtSignal(dict)
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº† 3 ä¸ªè‡ªå®šä¹‰ä¿¡å·ï¼š

1. **å®Œæˆä¿¡å·**ï¼Œæ²¡æœ‰æ•°æ®è¡¨æ˜ä»»åŠ¡ä½•æ—¶å®Œæˆ
2. **é”™è¯¯ä¿¡å·**ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªç”±å¼‚å¸¸ç±»å‹ã€å¼‚å¸¸å€¼å’Œæ ¼å¼åŒ–è·Ÿè¸ªä¿¡æ¯ç»„æˆçš„å…ƒç»„ã€‚
3. **ç»“æœä¿¡å·**ï¼Œæ¥æ”¶æ‰§è¡Œå‡½æ•°çš„ä»»ä½•å¯¹è±¡ç±»å‹

æ‚¨å¯èƒ½å¹¶ä¸éœ€è¦æ‰€æœ‰è¿™äº›ä¿¡å·ï¼Œä½†å®ƒä»¬è¢«åŒ…æ‹¬è¿›æ¥æ˜¯ä¸ºäº†è¡¨æ˜å…¶å¯èƒ½æ€§ã€‚åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨è¿™äº›ä¿¡å·æ¥é€šçŸ¥ä¸€ä¸ªç®€å•çš„è®¡ç®—å·¥ä½œè¿›ç¨‹çš„å®Œæˆå’Œé”™è¯¯ã€‚

*Listing 180. concurrent/qrunnable_3.py*

```python
import random
import sys
import time

from PyQt6.QtCore import (
    QObject,
    QRunnable,
    QThreadPool,
    QTimer,
    pyqtSignal,
    pyqtSlot,
)
from PyQt6.QtWidgets import (
    QApplication,
    QLabel,
    QMainWindow,
    QPushButton,
    QVBoxLayout,
    QWidget,
)


class WorkerSignals(QObject):
    """
    å®šä¹‰è¿è¡Œä¸­çš„å·¥ä½œçº¿ç¨‹å¯ç”¨çš„ä¿¡å·ã€‚
    æ”¯æŒçš„ä¿¡å·åŒ…æ‹¬ï¼š
    finished
        æ— æ•°æ®
    error
        `str` å¼‚å¸¸å­—ç¬¦ä¸²
    result
        `dict` å¤„ç†è¿”å›çš„æ•°æ®
    """
    finished = pyqtSignal()
    error = pyqtSignal(str)
    result = pyqtSignal(dict)
    
    
class Worker(QRunnable):
    """
    å·¥ä½œçº¿ç¨‹
    :param args: ä¼ é€’ç»™è¿è¡Œä»£ç çš„å‚æ•°
    :param kwargs: ä¼ é€’ç»™è¿è¡Œçš„å…³é”®å­—å‚æ•°
    :code
    :
    """
    def __init__(self, iterations=5):
        super().__init__()
        self.signals = (
            WorkerSignals()
        ) # åˆ›å»ºä¿¡å·ç±»çš„å®ä¾‹.
        self.iterations = iterations
            
    @pyqtSlot()
    def run(self):
    """
    ä½¿ç”¨ä¼ é€’çš„ self.args åˆå§‹åŒ– runner å‡½æ•°ï¼Œ
    """
        try:
            for n in range(self.iterations):
                time.sleep(0.01)
                v = 5 / (40 - n)
                
        except Exception as e:
            self.signals.error.emit(str(e))
            
        else:
            self.signals.finished.emit()
            self.signals.result.emit({"n": n, "value": v})
            
            
class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        
        self.threadpool = QThreadPool()
        print(
            "Multithreading with maximum %d threads"
            % self.threadpool.maxThreadCount()
        )
        
        self.counter = 0
        
        layout = QVBoxLayout()
        
        self.l = QLabel("Start")
        b = QPushButton("DANGER!")
        b.pressed.connect(self.oh_no)
        
        layout.addWidget(self.l)
        layout.addWidget(b)
        
        w = QWidget()
        w.setLayout(layout)
        
        self.setCentralWidget(w)
        
        self.show()
        
        self.timer = QTimer()
        self.timer.setInterval(1000)
        self.timer.timeout.connect(self.recurring_timer)
        self.timer.start()
        
    def oh_no(self):
        worker = Worker(iterations=random.randint(10, 50))
        worker.signals.result.connect(self.worker_output)
        worker.signals.finished.connect(self.worker_complete)
        worker.signals.error.connect(self.worker_error)
        self.threadpool.start(worker)
        
        
    def worker_output(self, s):
        print("RESULT", s)
        
    def worker_complete(self):
        print("THREAD COMPLETE!")
        
    def worker_error(self, t):
        print("ERROR: %s" % t)
        
    def recurring_timer(self):
        self.counter += 1
        self.l.setText("Counter: %d" % self.counter)
        
    
app = QApplication(sys.argv)
window = MainWindow()
app.exec()
```

æ‚¨å¯ä»¥å°†è‡ªå·±çš„å¤„ç†å‡½æ•°è¿æ¥åˆ°è¿™äº›ä¿¡å·ï¼Œä»¥æ¥æ”¶çº¿ç¨‹å®Œæˆï¼ˆæˆ–ç»“æœï¼‰çš„é€šçŸ¥ã€‚\è¯¥ç¤ºä¾‹æ—¨åœ¨å¶å°”æŠ›å‡ºé™¤ä»¥é›¶å¼‚å¸¸ï¼Œæ‚¨å°†åœ¨è¾“å‡ºä¸­çœ‹åˆ°è¯¥å¼‚å¸¸ã€‚

```bash
Multithreading with maximum 12 threads
THREAD COMPLETE!
RESULT {'n': 16, 'value': 0.20833333333333334}
ERROR: division by zero
THREAD COMPLETE!
RESULT {'n': 11, 'value': 0.1724137931034483}
THREAD COMPLETE!
RESULT {'n': 22, 'value': 0.2777777777777778}
ERROR: division by zero
```

åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨è¿™ç§æ–¹æ³•çš„å‡ ç§ä¸åŒå˜ä½“ï¼Œè¿™äº›å˜ä½“ä½¿æ‚¨èƒ½å¤Ÿåœ¨è‡ªå·±çš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ `QThreadPool` å®ç°ä¸€äº›æœ‰è¶£çš„åŠŸèƒ½ã€‚
